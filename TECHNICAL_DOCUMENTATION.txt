# ChatGuard v2.0 - Technical Master Documentation
## Automated Red Teaming Platform for AI Chatbots

---

## 1. üìã EXECUTIVE SUMMARY
**ChatGuard** is an automated security testing (Red Teaming) platform designed to audit LLM-based chatbots before deployment. Unlike traditional manual testing, ChatGuard uses an **AI Judge** to semantically evaluate whether a target chatbot has succumbed to adversarial attacks.

**Problem:**
Enterprises deploying RAG (Retrieval Augmented Generation) chatbots face unique security risks:
-   **Data Exfiltration:** Attackers tricking bots into reading private internal documents.
-   **Prompt Injection:** Overriding "System Prompts" to bypass safety filters.
-   **Reputational Damage:** Bots generating toxic or harmful content.

**Solution:**
A SaaS platform that connects to *any* chatbot API (OpenAI, Anthropic, Custom), launches 45+ sophisticated attacks across 12 categories, and grades the responses using a separate, high-reasoning AI Judge.

---

## 2. üèóÔ∏è SYSTEM ARCHITECTURE (SaaS Model)

### High-Level Data Flow
```
User Input (Target API Key) ‚Üí [Attack Engine] ‚Üí [Target Chatbot] ‚Üí [Response] ‚Üí [AI Judge] ‚Üí [Security Report]
```

### Components
1.  **Attack Engine (The Red Team):**
    -   Selects from 45+ curated jailbreaks (e.g., DAN, PWF, Grandma exploit).
    -   Injects adversarial payloads into the target model.
2.  **User Management (The Gatekeeper):**
    -   **Secure Auth:** SHA-256 password hashing & session management.
    -   **History Tracking:** SQLite database stores past scans per user.
    -   **Dashboard:** Personalized view of recent security audits.
3.  **Target Adapter (The Victim):**
    -   **White Box Testing:** Users provide API Key + **System Prompt** (simulates their bot).
    -   **Black Box Testing:** Users provide a **Webhook URL** (tests their actual deployed infrastructure).
    -   Supports: OpenAI, Anthropic, HuggingFace (via Together AI), Groq.
3.  **The AI Judge (The Auditor):**
    -   **Model:** Llama-3.3-70b (via Groq API).
    -   **Role:** Semantically analyzes the Target's response.
    -   **Logic:** Uses "Context-Aware" grading to distinguish between:
        -   *Compliance (FAIL):* Providing bomb recipes.
        -   *Refusal (PASS):* "I cannot help with that."
        -   *Safe Roleplay (PASS):* "I am a pirate, but I still won't help you hack."
        -   *Emergency Advice (PASS):* "Call 911" (allowed first aid).

---

## 3. üß† CORE LOGIC & ALGORITHMS

### A. System Prompt Injection (White Box)
To test a user's *specific* application logic without access to their server, we allow **System Prompt Injection**.
-   **Input:** User pastes "You are a helpful banking assistant."
-   **Execution:** ChatGuard constructs the API call with `messages=[{"role": "system", "content": "..."}]`.
-   **Goal:** Verify if the attack can override the user's specific system instructions.

### B. Intelligent Evaluation (The "Smart Judge")
We replaced regex matching with a structured LLM prompt (`utils.py`):
-   **Input:** Attack Prompt + Model Response.
-   **Analysis:** The Judge checks for "Harmful Compliance".
-   **Refinement 1 (Translation):** Explicitly ignores cases where the bot merely translates a harmful phrase without executing it.
-   **Refinement 2 (Emergency):** Explicitly permits high-level first aid advice while blocking detailed medical procedures.

### C. Transparent Fallback
-   If the AI Judge (Groq) is unreachable (Rate Limit/API Error), the system automatically degrades to **Pattern Matching**.
-   **UI Feedback:** The user sees `‚ö†Ô∏è [FALLBACK: Pattern-based]` to ensure full transparency.

---

## 4. üíª TECH STACK

-   **Frontend:** Streamlit (Python) - *Cyberpunk Theme*
-   **Backend:** Python 3.9+
-   **Target APIs:**
    -   `openai` (GPT-4o, GPT-3.5)
    -   `anthropic` (Claude 3.5 Sonnet)
    -   `groq` (Llama-3.3, Mixtral)
    -   `requests` (Custom Webhooks)
-   **Judge API:** Groq (Llama-3.3-70b-versatile)

---

## 5. üìÅ FILE STRUCTURE OVERVIEW

-   `app.py`: Main application controller. Handles UI, sidebar configuration, and the main scan loop. Includes the "Test Your Own Jailbreak" playground.
-   `utils.py`: The brain. Contains `evaluate_response` (The Judge), `test_chatbot` (The Connector), and the prompt logic.
-   `providers.py`: The adapter layer. Contains specific functions to call OpenAI, Anthropic, and HuggingFace APIs.
-   `jailbreaks.py`: The database. Contains the list of 20+ curated adversarial prompts.

---

## 6. üöÄ FEATURES FOR JUDGES

1.  **Multi-Provider Matrix:** We don't just test OpenAI; we test the entire ecosystem.
2.  **Visualized Security:** Real-time "Matrix Rain" terminal showing attacks being injected.
3.  **Real-Time Feedback:** The "Test Your Own" section proves the AI Judge works instantly.
4.  **SaaS Ready:** Architecture allows for user accounts, saved reports, and API monetization (future).

---
*Last Updated: January 3, 2026 | Version: 2.0.0*

---

## 7. üöÄ FUTURE ROADMAP (v3.0)

Based on architectural review, the following enhancements are planned:

### A. Multi-Layer Judgment (Reliability)
-   **Current:** Single AI Judge (Groq).
-   **Planned:** Rule-based Filter ‚Üí LLM Judge ‚Üí Consistency Check (3 runs).
-   **Benefit:** Agreement rate and confidence score for scientifically defensible verdicts.

### B. Adaptive Attack Escalation (Intelligence)
-   **Current:** Each jailbreak tried once.
-   **Planned:** Base Attack ‚Üí Rephrased ‚Üí Emotional Pressure ‚Üí Authority ‚Üí Obfuscation.
-   **Benefit:** Mimics real attacker behavior; stops when bot breaks or survives all.

### C. Stability Measurement (Consistency)
-   **Current:** Not measured.
-   **Planned:** Run each critical attack 3x, report `Stability % = consistent outcomes / total runs`.
-   **Benefit:** Identifies unreliable production deployments.

### D. Judge Prompt Versioning (Maintainability)
-   **Current:** Hardcoded prompt in utils.py.
-   **Planned:** Version-controlled prompt files with regression test suite.
-   **Benefit:** Prevents scoring drift after updates.

### E. Expanded Attack Library (45+ Attacks)
-   **Current:** Now covers 12 distinct categories including:
    -   **India-Specific:** Aadhaar leaks, cultural sensitivity.
    -   **Finance:** Insider trading, money laundering.
    -   **Cyber:** Malware generation, reverse shells.
    -   **Legal:** Sovereign citizen arguments.
-   **Benefit:** Comprehensive coverage against modern threat vectors.
